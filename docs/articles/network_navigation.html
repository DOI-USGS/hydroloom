<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hydroloom">
<title>Network Navigation • hydroloom</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Network Navigation">
<meta property="og:description" content="hydroloom">
<meta property="og:image" content="https://doi-usgs.github.io/hydroloom/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hydroloom</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/hydroloom.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_network.html">Topological Sort Based Network Attributes</a>
    <a class="dropdown-item" href="../articles/flow-table.html">NHD Flow Table with Hydroloom</a>
    <a class="dropdown-item" href="../articles/network_navigation.html">Network Navigation</a>
    <a class="dropdown-item" href="../articles/non-dendritic.html">Non-dendritic networks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DOI-USGS/hydroloom/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Network Navigation</h1>
                        <h4 data-toc-skip class="author"><a href="mailto:dblodgett@usgs.gov" class="email">dblodgett@usgs.gov</a></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DOI-USGS/hydroloom/blob/HEAD/vignettes/network_navigation.Rmd" class="external-link"><code>vignettes/network_navigation.Rmd</code></a></small>
      <div class="d-none name"><code>network_navigation.Rmd</code></div>
    </div>

    
    
<style type="text/css">
   .main-container {max-width: 100%;}
   .row {display: flex;}
   .column {flex: 50%;}
</style>
<div class="section level2">
<h2 id="network-navigation">Network Navigation<a class="anchor" aria-label="anchor" href="#network-navigation"></a>
</h2>
<p>One of the most common operations with hydrologic and hydrographic
networks is referred to as “navigation”. To “navigate” the network is
the action of traversing network connections according to a set of
rules. There four primary types of network navigation, two in the
upstream direction and two in the downstream direction and only along a
main path or including branches. In <code>hydroloom</code>, these
navigation types are referred to as <code>upmain</code>,
<code>downmain</code>, <code>up</code> and <code>down</code>. Additional
rules, such as a desired maximum distance, can be applied to any of the
four types.</p>
<p><code>Hydroloom</code> has two functions that support network
navigation.</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/navigate_network_dfs.html">navigate_network_dfs()</a></code>, requires the “flownetwork”
representation of a hydrologic network (see
<code><a href="../reference/to_flownetwork.html">to_flownetwork()</a></code>) and returns ids encountered along the
requested navigation as a list of contiguous paths.</li>
<li>
<code><a href="../reference/navigate_hydro_network.html">navigate_hydro_network()</a></code> currently (5/2024) requires
the nhdplus representation of a hydrologic network (see
<code><a href="../articles/advanced_network.html">vignette("advanced_network")</a></code>) and returns ids encountered
along the requested navigation as a single vector.</li>
</ol>
<p>While similar, the two functions use completely different
implementations. <code><a href="../reference/navigate_network_dfs.html">navigate_network_dfs()</a></code> uses a
graph-theoretic “depth first search” with <code>upmain</code> and
<code>downmain</code> attributes for all flownetwork connections.
<code><a href="../reference/navigate_hydro_network.html">navigate_hydro_network()</a></code> relies on <code>topo_sort</code>,
<code>levelpath</code>, and other nhdplus attributes to support network
navigation.</p>
<p>For the rest of this vignette, we will use the new_hope sample
dataset included with hydroloom. A map some basic summary information
about the data are shown just below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DOI-USGS/hydroloom" class="external-link">hydroloom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">hy_net</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/new_hope.gpkg"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">"hydroloom"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 746</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sf"         "tbl_df"     "tbl"        "data.frame"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "COMID"      "GNIS_ID"    "GNIS_NAME"  "LENGTHKM"   "REACHCODE" </span></span>
<span><span class="co">#&gt;  [6] "WBAREACOMI" "FTYPE"      "FCODE"      "StreamLeve" "StreamOrde"</span></span>
<span><span class="co">#&gt; [11] "StreamCalc" "FromNode"   "ToNode"     "Hydroseq"   "LevelPathI"</span></span>
<span><span class="co">#&gt; [16] "Pathlength" "TerminalPa" "ArbolateSu" "Divergence" "StartFlag" </span></span>
<span><span class="co">#&gt; [21] "TerminalFl" "DnLevel"    "UpLevelPat" "UpHydroseq" "DnLevelPat"</span></span>
<span><span class="co">#&gt; [26] "DnMinorHyd" "DnDrainCou" "DnHydroseq" "FromMeas"   "ToMeas"    </span></span>
<span><span class="co">#&gt; [31] "RtnDiv"     "VPUIn"      "VPUOut"     "AreaSqKM"   "TotDASqKM" </span></span>
<span><span class="co">#&gt; [36] "geom"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="../reference/hy.html">hy</a></span><span class="op">(</span><span class="va">hy_net</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hy"         "tbl_df"     "tbl"        "data.frame"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/hy.html">hy</a></span><span class="op">(</span><span class="va">hy_net</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id"                        "length_km"                </span></span>
<span><span class="co">#&gt;  [3] "aggregate_id"              "wbid"                     </span></span>
<span><span class="co">#&gt;  [5] "feature_type"              "feature_type_code"        </span></span>
<span><span class="co">#&gt;  [7] "stream_level"              "stream_order"             </span></span>
<span><span class="co">#&gt;  [9] "stream_calculator"         "fromnode"                 </span></span>
<span><span class="co">#&gt; [11] "tonode"                    "topo_sort"                </span></span>
<span><span class="co">#&gt; [13] "levelpath"                 "pathlength_km"            </span></span>
<span><span class="co">#&gt; [15] "terminal_topo_sort"        "arbolate_sum"             </span></span>
<span><span class="co">#&gt; [17] "divergence"                "start_flag"               </span></span>
<span><span class="co">#&gt; [19] "terminal_flag"             "dn_stream_level"          </span></span>
<span><span class="co">#&gt; [21] "up_levelpath"              "up_topo_sort"             </span></span>
<span><span class="co">#&gt; [23] "dn_levelpath"              "dn_minor_topo_sort"       </span></span>
<span><span class="co">#&gt; [25] "dn_topo_sort"              "aggregate_id_from_measure"</span></span>
<span><span class="co">#&gt; [27] "aggregate_id_to_measure"   "da_sqkm"                  </span></span>
<span><span class="co">#&gt; [29] "total_da_sqkm"</span></span>
<span></span>
<span><span class="co"># map utilities</span></span>
<span><span class="va">map_prep</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span>, <span class="va">tol</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># no attributes</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3857</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># basemap projection</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_simplify</a></span><span class="op">(</span>dTolerance <span class="op">=</span> <span class="va">tol</span><span class="op">)</span> <span class="co"># sleaner rendering</span></span>
<span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flowline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># to hide flowlines in basemap</span></span>
<span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># par is reset in cleanup</span></span>
<span><span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/plot_nhdplus.html" class="external-link">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, plot_config <span class="op">=</span> <span class="va">pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span>
<span><span class="co">#&gt; Zoom set to: 11</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_navigation_files/figure-html/unnamed-chunk-1-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="nhdplus-based-network-navigation-">NHDPlus-based network navigation.<a class="anchor" aria-label="anchor" href="#nhdplus-based-network-navigation-"></a>
</h2>
<p>The nhdplus data model has network attributes, like
<code>levelpath</code> that provide a shortcut to “main” navigations. A
path of flowlines that flow from a most upstream headwater to the outlet
of a given <code>levelpath</code> in the network have the same
<code>levelpath</code> id. Additionally, every feature has a
<code>up_levelpath</code> and <code>dn_levelpath</code> indicating the
<code>levelpath</code> of the flowline upstream and downstream along the
“main” path respectively. These attributes, combined with relatively
simple table operations, enable navigation up and down stream along the
network. While <code>levelpath</code> attributes are the key to the
algorithm, <code>topo_sort</code>, <code>dn_toposort</code>,
<code>dn_mino_hydro</code>, <code>length_km</code>, and
<code>pathlength_km</code> are also used to accomplish aspects of the
algorithm implemented in<code><a href="../reference/navigate_hydro_network.html">navigate_hydro_network()</a></code>.</p>
<p>When working with data that uses the nhdplus data model,
<code><a href="../reference/navigate_hydro_network.html">navigate_hydro_network()</a></code> works with no pre-processing.
Below, all network navigation modes are demonstrated using the sample
data as is from NHDPlusV2.</p>
<p>First, we can extract some key features that will help illustrate the
network navigation functionality. In line comments illustrate what is
being done.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># work in hydroloom attribute names for demo sake</span></span>
<span><span class="va">hy_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hy.html">hy</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the smallest topo_sort is the most downstream</span></span>
<span><span class="va">outlet</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">topo_sort</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">$</span><span class="va">topo_sort</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># features with the levelpath of the outlet are the mainpath, </span></span>
<span><span class="co"># or mainstem of the network</span></span>
<span><span class="va">main_path</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">levelpath</span> <span class="op">==</span> <span class="va">outlet</span><span class="op">$</span><span class="va">levelpath</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># the largest topo sort along the main path is its headwater flowline</span></span>
<span><span class="va">headwater</span> <span class="op">&lt;-</span> <span class="va">main_path</span><span class="op">[</span><span class="va">main_path</span><span class="op">$</span><span class="va">topo_sort</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">main_path</span><span class="op">$</span><span class="va">topo_sort</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># basemap</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/plot_nhdplus.html" class="external-link">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, plot_config <span class="op">=</span> <span class="va">pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom set to: 11</span></span>
<span></span>
<span><span class="co"># plot the elements prepped above</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"dodgerblue2"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">outlet</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"magenta"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">headwater</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"magenta"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">main_path</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_navigation_files/figure-html/unnamed-chunk-2-1.png" width="384" style="display: block; margin: auto;">
We can reproduce the path extracted above with a network navigation,
which is a more natural approach for most applications. Below, we see
how to use navigate_hydro_network from a starting location and use the
<code>distance</code> parameter to limit how far we will navigate from
the start point.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># this is just the ids</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_hydro_network.html">navigate_hydro_network</a></span><span class="op">(</span><span class="va">hy_net</span>, </span>
<span>                               start <span class="op">=</span> <span class="va">outlet</span><span class="op">$</span><span class="va">id</span>, </span>
<span>                               mode <span class="op">=</span> <span class="st">"UM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter the source data to get the id's representation </span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">path</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># pathlength_km is the distance from the furthest downstream network outlet</span></span>
<span><span class="co"># it is used within navigate_hydro_network to filter to a given distance.</span></span>
<span><span class="va">pathlength</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">path</span><span class="op">$</span><span class="va">pathlength_km</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">path</span><span class="op">$</span><span class="va">pathlength_km</span><span class="op">)</span></span>
<span></span>
<span><span class="va">half_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_hydro_network.html">navigate_hydro_network</a></span><span class="op">(</span><span class="va">hy_net</span>, </span>
<span>                               start <span class="op">=</span> <span class="va">outlet</span><span class="op">$</span><span class="va">id</span>, </span>
<span>                               mode <span class="op">=</span> <span class="st">"UM"</span>, </span>
<span>                               distance <span class="op">=</span> <span class="va">pathlength</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">half_path</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">half_path</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/plot_nhdplus.html" class="external-link">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, plot_config <span class="op">=</span> <span class="va">pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom set to: 11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"dodgerblue2"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">half_path</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"magenta"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_navigation_files/figure-html/unnamed-chunk-3-1.png" width="384" style="display: block; margin: auto;">
Now we can look at the more complete up and down navigation. Sometimes
these are called “upstream with tributaries” and “downstream with
diversions” or “UT” and “DD”. For demonstration sake, we will start at
the top of the half path found above. More typically, this would be
starting from a known location, such as where a gage site is
located.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">half_path</span><span class="op">[</span><span class="va">half_path</span><span class="op">$</span><span class="va">topo_sort</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">half_path</span><span class="op">$</span><span class="va">topo_sort</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">up</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_hydro_network.html">navigate_hydro_network</a></span><span class="op">(</span><span class="va">hy_net</span>, </span>
<span>                             start <span class="op">=</span> <span class="va">start</span><span class="op">$</span><span class="va">id</span>, </span>
<span>                             mode <span class="op">=</span> <span class="st">"UT"</span><span class="op">)</span></span>
<span><span class="va">up</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">up</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">down</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_hydro_network.html">navigate_hydro_network</a></span><span class="op">(</span><span class="va">hy_net</span>,</span>
<span>                               start <span class="op">=</span> <span class="va">start</span><span class="op">$</span><span class="va">id</span>,</span>
<span>                               mode <span class="op">=</span> <span class="st">"DD"</span><span class="op">)</span></span>
<span><span class="va">down</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">down</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/plot_nhdplus.html" class="external-link">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, plot_config <span class="op">=</span> <span class="va">pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom set to: 11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"dodgerblue2"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">start</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"magenta"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">up</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">down</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_navigation_files/figure-html/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;">
With the above, assuming nhdplus attributes are available, a wide range
of network navigation applications are possible. However, the sweet of
nhdplus attributes are not always available. When this is the case,
<code><a href="../reference/navigate_network_dfs.html">navigate_network_dfs()</a></code> is useful.</p>
</div>
<div class="section level2">
<h2 id="flownetwork-based-navigation">flownetwork-based navigation<a class="anchor" aria-label="anchor" href="#flownetwork-based-navigation"></a>
</h2>
<p>In contrast with <code><a href="../reference/navigate_hydro_network.html">navigate_hydro_network()</a></code>,
<code><a href="../reference/navigate_network_dfs.html">navigate_network_dfs()</a></code> can perform <code>up</code> and
<code>down</code> navigation with only a network topology described as
<code>id</code> and <code>toid</code>. If <code>upmain</code> and
<code>downmain</code> attributes are also available, it can also perform
main path navigation.</p>
<p>First, it’s worth reviewing the definition of “upmain” and “downmain”
in the context of the flow network.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hydroloom_name_definitions</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydroloom_name_definitions</span><span class="op">)</span> <span class="op">==</span> <span class="st">"upmain"</span><span class="op">]</span></span>
<span><span class="co">#&gt;                                                                                      upmain </span></span>
<span><span class="co">#&gt; "indicates that a given network element is the primary upstream connection at a confluence"</span></span>
<span><span class="va">hydroloom_name_definitions</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hydroloom_name_definitions</span><span class="op">)</span> <span class="op">==</span> <span class="st">"downmain"</span><span class="op">]</span></span>
<span><span class="co">#&gt;                                                                                      downmain </span></span>
<span><span class="co">#&gt; "indicates that a given network element is the primary downstream connection at a confluence"</span></span></code></pre></div>
<p>Using these definitions, we can add to the non-dendritic network
example in <code><a href="../articles/hydroloom.html">vignette("hydroloom")</a></code> by defining “upmain” and
“downmain” attributes on it. In this simple network, we have one
divergence and one confluence. Notice that where <code>id</code> 1
appears twice, it has one and only one downmain TRUE (4) and where
<code>toid</code> 5 appears twice, it has one and only one upmain TRUE
(4).</p>
<div class="row">
<div class="column">
<p><img src="network_navigation_files/figure-html/dend_fig-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div class="column">
<table class="table">
<thead><tr class="header">
<th>id</th>
<th>toid</th>
<th>upmain</th>
<th>downmain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>TRUE</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>1</td>
<td>4</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>3</td>
<td>5</td>
<td>FALSE</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>4</td>
<td>5</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>5</td>
<td>0</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>Hydroloom</code> provides utilities to construct this
lightweight flownetwork format from a geometric network in
<code><a href="../reference/make_attribute_topology.html">make_attribute_topology()</a></code>. <code>upmain</code> and
<code>downmain</code> attributes can be constructed using
<code><a href="../reference/add_divergence.html">add_divergence()</a></code>, <code><a href="../reference/add_levelpaths.html">add_levelpaths()</a></code>, and
<code>to_flownetwork</code>. In this demonstration, we have
<code>divergence</code> and <code>levelpath</code> attributes already,
but reconstructing them is shown below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># select only id, name, feature_type. </span></span>
<span><span class="co"># Note that the geometry is "sticky" and is included in base_net</span></span>
<span><span class="va">base_net</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hy_net</span>, <span class="va">id</span>, <span class="va">GNIS_NAME</span>, <span class="va">feature_type</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a geometric network -- this includes divergences</span></span>
<span><span class="va">base_net</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="../reference/make_attribute_topology.html">make_attribute_topology</a></span><span class="op">(</span><span class="va">base_net</span>, min_distance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>                             <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">base_net</span>, <span class="va">id</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: future</span></span>
<span><span class="co">#&gt; Loading required namespace: future.apply</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id"           "GNIS_NAME"    "feature_type" "toid"         "geom"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 832</span></span>
<span></span>
<span><span class="co"># now switch from a flownetwork topology to a node topology.</span></span>
<span><span class="va">base_net</span> <span class="op">&lt;-</span> <span class="fu">hydroloom</span><span class="fu">::</span><span class="fu"><a href="../reference/make_node_topology.html">make_node_topology</a></span><span class="op">(</span><span class="va">base_net</span>, add_div <span class="op">=</span> <span class="cn">TRUE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id"           "fromnode"     "tonode"       "GNIS_NAME"    "feature_type"</span></span>
<span><span class="co">#&gt; [6] "geom"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 746</span></span>
<span></span>
<span><span class="co"># divergence determination needs a dominant feature type input</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">$</span><span class="va">feature_type</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "StreamRiver"    "Connector"      "ArtificialPath"</span></span>
<span></span>
<span><span class="va">base_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_divergence.html">add_divergence</a></span><span class="op">(</span><span class="va">base_net</span>, </span>
<span>                           coastal_outlet_ids <span class="op">=</span> <span class="va">outlet</span><span class="op">$</span><span class="va">id</span>, </span>
<span>                           inland_outlet_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                           name_attr <span class="op">=</span> <span class="st">"GNIS_NAME"</span>, </span>
<span>                           type_attr <span class="op">=</span> <span class="st">"feature_type"</span>, </span>
<span>                           major_types <span class="op">=</span> <span class="st">"StreamRiver"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id"           "fromnode"     "tonode"       "GNIS_NAME"    "feature_type"</span></span>
<span><span class="co">#&gt; [6] "geom"         "divergence"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 746</span></span>
<span></span>
<span><span class="co"># now we can add a dendritic toid attribute because we have "divergence"</span></span>
<span><span class="va">base_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_toids.html">add_toids</a></span><span class="op">(</span><span class="va">base_net</span>, return_dendritic <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note that no rows were added -- these are only downmain!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 746</span></span>
<span></span>
<span><span class="co"># now add a length attribute as the accumulated flowline length.</span></span>
<span><span class="va">base_net</span><span class="op">$</span><span class="va">length_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">base_net</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/accumulate_downstream.html">accumulate_downstream</a></span><span class="op">(</span><span class="va">base_net</span>, <span class="st">"length_km"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_levelpaths.html">add_levelpaths</a></span><span class="op">(</span><span class="va">base_net</span>, </span>
<span>                           name_attribute <span class="op">=</span> <span class="st">"GNIS_NAME"</span>,</span>
<span>                           weight_attribute <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id"                  "toid"                "levelpath_outlet_id"</span></span>
<span><span class="co">#&gt;  [4] "topo_sort"           "levelpath"           "geom"               </span></span>
<span><span class="co">#&gt;  [7] "tonode"              "GNIS_NAME"           "feature_type"       </span></span>
<span><span class="co">#&gt; [10] "divergence"          "fromnode"            "length_km"          </span></span>
<span><span class="co">#&gt; [13] "weight"</span></span>
<span></span>
<span><span class="co">#remove dendritic toid used above</span></span>
<span><span class="va">base_net</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">base_net</span>, <span class="op">-</span><span class="va">toid</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flow_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_flownetwork.html">to_flownetwork</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">flow_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 832</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">flow_net</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id"       "toid"     "upmain"   "downmain"</span></span></code></pre></div>
<p>With the above, we have a flow network. The above demonstration
wasn’t strictly necessary given that the demo NHDPlus data has all the
attributes we need to construct a flow network. However, the
demonstration shows how the NHDPlus attributes relate to the more direct
and lightweight flownetwork attributes. Note that while the hydroloom
methods are nearly identical to those of NHDPlus, there are some very
minor differences, as shown below, nearly all the upmain and dowmain
connections are the same, but differences can occur.</p>
<p>Comparing the two results, we see that only one junction has a
different upmain attribute. Inspection shows that the difference is due
to dendritic accumulation (divergences get 0% of the upstream value) of
flowline length in hydroloom vs un-apportioned accumulation (divergences
get 100% of the upstream value) in NHDPlus when calculating weights for
the divergence attribute and is negligible.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">flow_net_nhdplus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_flownetwork.html">to_flownetwork</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">toid</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flow_net_hydroloom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_flownetwork.html">to_flownetwork</a></span><span class="op">(</span><span class="va">base_net</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">toid</span><span class="op">)</span></span>
<span></span>
<span><span class="va">different_downmain</span> <span class="op">&lt;-</span> <span class="va">flow_net_nhdplus</span><span class="op">[</span><span class="va">flow_net_nhdplus</span><span class="op">$</span><span class="va">downmain</span> <span class="op">!=</span> <span class="va">flow_net_hydroloom</span><span class="op">$</span><span class="va">downmain</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">different_downmain</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;      id  toid upmain downmain</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span></span>
<span><span class="va">different_upmain</span> <span class="op">&lt;-</span> <span class="va">flow_net_nhdplus</span><span class="op">[</span><span class="va">flow_net_nhdplus</span><span class="op">$</span><span class="va">upmain</span> <span class="op">!=</span> <span class="va">flow_net_hydroloom</span><span class="op">$</span><span class="va">upmain</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">different_upmain</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;        id    toid upmain downmain</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 8<span style="text-decoration: underline;">893</span>470 8<span style="text-decoration: underline;">893</span>552 TRUE   TRUE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 8<span style="text-decoration: underline;">893</span>472 8<span style="text-decoration: underline;">893</span>552 FALSE  TRUE    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span></span></span>
<span></span>
<span><span class="va">different_upmain</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">different_upmain</span><span class="op">$</span><span class="va">id</span>, <span class="va">different_upmain</span><span class="op">$</span><span class="va">toid</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/plot_nhdplus.html" class="external-link">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">different_upmain</span><span class="op">)</span>, plot_config <span class="op">=</span> <span class="va">pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they</span></span>
<span><span class="co">#&gt; are planar</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched on</span></span>
<span><span class="co">#&gt; Zoom set to: 12</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">hy_net</span>, <span class="fl">10</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"dodgerblue2"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">different_upmain</span>, <span class="fl">10</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_navigation_files/figure-html/unnamed-chunk-7-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Now that we have a flownetwork, we can perform the same navigations
as were conducted earlier only this time, with only the basic network,
not including the NHDPlus attributes.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># this is just the ids</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_network_dfs.html">navigate_network_dfs</a></span><span class="op">(</span><span class="va">flow_net</span>, </span>
<span>                             starts <span class="op">=</span> <span class="va">outlet</span><span class="op">$</span><span class="va">id</span>,</span>
<span>                             direction <span class="op">=</span> <span class="st">"upmain"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter the source data to get the id's representation </span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># distance not yet supported</span></span>
<span><span class="va">half_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_network_dfs.html">navigate_network_dfs</a></span><span class="op">(</span><span class="va">flow_net</span>, </span>
<span>                                  starts <span class="op">=</span> <span class="fl">8893396</span>, <span class="co"># chosen from a map</span></span>
<span>                                  direction <span class="op">=</span> <span class="st">"downmain"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">half_path</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">half_path</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/plot_nhdplus.html" class="external-link">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, plot_config <span class="op">=</span> <span class="va">pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom set to: 11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"dodgerblue2"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">half_path</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"magenta"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_navigation_files/figure-html/unnamed-chunk-8-1.png" width="384" style="display: block; margin: auto;">
Now we can look at the more complete up and down navigation. Sometimes
these are called “upstream with tributaries” and “downstream with
diversions” or “UT” and “DD”. For demonstration sake, we will start at
the top of the half path found above. More typically, this would be
starting from a known location, such as where a gage site is
located.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># chosen from map</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fl">8893396</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">up</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_network_dfs.html">navigate_network_dfs</a></span><span class="op">(</span><span class="va">flow_net</span>, </span>
<span>                           starts <span class="op">=</span> <span class="va">start</span><span class="op">$</span><span class="va">id</span>, </span>
<span>                           direction <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span></span>
<span><span class="va">up</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">up</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">down</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/navigate_network_dfs.html">navigate_network_dfs</a></span><span class="op">(</span><span class="va">flow_net</span>,</span>
<span>                               starts <span class="op">=</span> <span class="va">start</span><span class="op">$</span><span class="va">id</span>,</span>
<span>                               direction <span class="op">=</span> <span class="st">"down"</span><span class="op">)</span></span>
<span><span class="va">down</span> <span class="op">&lt;-</span> <span class="va">hy_net</span><span class="op">[</span><span class="va">hy_net</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/plot_nhdplus.html" class="external-link">plot_nhdplus</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, plot_config <span class="op">=</span> <span class="va">pc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom set to: 11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">hy_net</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"dodgerblue2"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">start</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"magenta"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">up</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">map_prep</span><span class="op">(</span><span class="va">down</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="network_navigation_files/figure-html/unnamed-chunk-9-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Blodgett.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
